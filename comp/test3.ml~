
let rec scan_pixel x y prev cur next = 
  if x < image_size.(0) then (

    (* まず、直接光追跡で得られたRGB値を得る *)
    veccpy rgb (p_rgb cur.(x));

    (* 次に、直接光の各衝突点について、間接受光による寄与を加味する *)
    if neighbors_exist x y next then
      try_exploit_neighbors x y prev cur next 0
    else
      do_without_neighbors cur.(x) 0;

    (* 得られた値をPPMファイルに出力 *)
    write_rgb ();

    scan_pixel (x + 1) y prev cur next
   ) else ()
in

  scan_pixel 0 0 rgb rgb rgb
